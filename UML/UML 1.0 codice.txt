@startuml

' --- STILI PER MATCHARE LE SLIDE ---
skinparam classAttributeIconSize 0
skinparam linetype ortho
skinparam monochrome true
skinparam classBackgroundColor White
skinparam shadowing false

' --- ENUMERAZIONI E STRUCT (Source 1: Slide 17, 15) ---
enum GradoDifficolta <<enumeration>> {
    Nuovo
    Disabitato
    Abitato
}

enum CategoriaLavoro <<enumeration>> {
    Interno
    Esterno
    Cartongesso
}

enum SottoCategoriaLavoro <<enumeration>> {
    InternoCivile
    InternoIndustriale
    EsternoCivile
    EsternoIndustriale
    Cart_Contropareti
    Cart_ParetiDivisorie
    Cart_Controsoffitti
    Cart_FinituraMuratura
}

class CicloInfo <<struct>> {
    + nome : const char*
    + prezzoMq : double
    + categoria : CategoriaLavoro
    + sottocategoria : SottoCategoriaLavoro
}

' --- CLASSI UTILITY (Moduli statici) ---
class CatalogoCicli <<utility>> {
    + {static} getNumeroCicli() : size_t
    + {static} getCiclo(index: size_t) : CicloInfo
    + {static} getNomeCicloDaIndice(index: int) : string
    + {static} isCartongessoIndex(index: int) : bool
}

class GestioneInputUI <<utility>> {
    + {static} chiediGradoDifficolta() : GradoDifficolta
    + {static} chiediCategoriaLavoro() : CategoriaLavoro
    + {static} chiediSottoCategoriaLavoro(cat: CategoriaLavoro) : SottoCategoriaLavoro
    + {static} menuCicliPerCategoria(cat: CategoriaLavoro, sub: SottoCategoriaLavoro) : int
}

class IdPreventivoGenerator <<utility>> {
    + {static} generaIdPreventivo() : string
}

class SalvataggioPreventivo <<utility>> {
    + {static} salvaPreventivoSuTxt(p: Preventivo, filename: string)
    + {static} salvaPreventivoSuCsv(p: Preventivo, filename: string)
}

' --- LISTINO ---
class ListinoPrezzi {
    - prezziMq_ : map<string, double>
    - coeffDifficolta_ : map<GradoDifficolta, double>
    + ListinoPrezzi()
    + impostaPrezzoMq(nomeCiclo: string, prezzo: double)
    + impostaCoeff(grado: GradoDifficolta, coeff: double)
    + getPrezzoMq(nomeCiclo: string) : double
    + getCoeff(grado: GradoDifficolta) : double
}

' --- GERARCHIA VOCI (Source 1: Slide 54 Generalization) ---
abstract class VoceCosto {
    # nome_ : string
    # unitaMisura_ : string
    # quantita_ : double
    # prezzoUnitario_ : double
    # coefficiente_ : double
    # VoceCosto(nome: string, unita: string, q: double, p: double)
    + {abstract} ~VoceCosto()
    + {abstract} subtotale() : double
    + {abstract} tipoVoce() : const char*
    + {abstract} clone() : unique_ptr<VoceCosto>
    + getNome() : string
    + getUnitaMisura() : string
    + getQuantita() : double
    + getPrezzoUnitario() : double
    + getCoefficiente() : double
}

class VoceTinteggiatura {
    + VoceTinteggiatura(nome: string, mq: double, listino: ListinoPrezzi, g: GradoDifficolta)
    + subtotale() : double
    + tipoVoce() : const char*
    + clone() : unique_ptr<VoceCosto>
}

class VoceCartongesso {
    + VoceCartongesso(nome: string, mq: double, listino: ListinoPrezzi, g: GradoDifficolta)
    + subtotale() : double
    + tipoVoce() : const char*
    + clone() : unique_ptr<VoceCosto>
}

' --- PREVENTIVO (Composizione) ---
class Preventivo {
    - id_ : string
    - cliente_ : string
    - grado_ : GradoDifficolta
    - voci_ : vector<unique_ptr<VoceCosto>>
    + Preventivo()
    + Preventivo(id: string, cliente: string, grado: GradoDifficolta)
    + Preventivo(other: Preventivo)
    + operator=(other: Preventivo) : Preventivo&
    + aggiungiVoce(voce: unique_ptr<VoceCosto>)
    + totale() : double
    + totaleMq() : double
    + ordinaPerNome()
    + riepilogo() : string
    + getVoci() : vector<unique_ptr<VoceCosto>>
}

' --- PATTERN BUILDER ---
class VoceCartongessoBuilder {
    - nomeCiclo_ : string
    - mq_ : double
    - listino_ : shared_ptr<ListinoPrezzi>
    - grado_ : GradoDifficolta
    + VoceCartongessoBuilder()
    + setNomeCiclo(nome: string) : VoceCartongessoBuilder&
    + setMq(mq: double) : VoceCartongessoBuilder&
    + setListino(listino: shared_ptr<ListinoPrezzi>) : VoceCartongessoBuilder&
    + setGrado(grado: GradoDifficolta) : VoceCartongessoBuilder&
    + build() : unique_ptr<VoceCosto>
}

' --- PATTERN STRATEGY / FACTORY ---
abstract class RegolaCosto {
    + {abstract} ~RegolaCosto()
    + {abstract} creaVoce(nome: string, mq: double, listino: shared_ptr<ListinoPrezzi>, grado: GradoDifficolta) : unique_ptr<VoceCosto>
}

class RegolaTinteggiatura {
    + creaVoce(...) : unique_ptr<VoceCosto>
}

class RegolaCartongesso {
    + creaVoce(...) : unique_ptr<VoceCosto>
}

class CalcolatorePreventivo {
    - regola_ : const RegolaCosto*
    + CalcolatorePreventivo()
    + setRegola(regola: const RegolaCosto*)
    + aggiungiLavoro(prev: Preventivo, nome: string, mq: double, list: shared_ptr<ListinoPrezzi>, grado: GradoDifficolta)
}

' --- RELAZIONI (Frecce rigorose) ---

' Ereditariet√† (Is-A)
VoceCosto <|-- VoceTinteggiatura
VoceCosto <|-- VoceCartongesso
RegolaCosto <|-- RegolaTinteggiatura
RegolaCosto <|-- RegolaCartongesso

' Composizione (Has-A + Ownership) - Source 2 Slide 26
Preventivo *-- "0..*" VoceCosto : possiede (unique_ptr) >

' Aggregazione (Has-A without Ownership) - Source 1 Slide 43
CalcolatorePreventivo o-- "0..1" RegolaCosto : usa strategia (ptr) >

' Dipendenze (Uses) - Source 2 Slide 57
VoceTinteggiatura ..> ListinoPrezzi : <<use>> (costruttore)
VoceCartongesso ..> ListinoPrezzi : <<use>> (costruttore)
Preventivo ..> GradoDifficolta : <<use>> (attributo)

' Relazioni Builder
VoceCartongessoBuilder --> "1" ListinoPrezzi : tiene puntatore (shared_ptr) >
VoceCartongessoBuilder ..> VoceCartongesso : <<create>>
RegolaCartongesso ..> VoceCartongessoBuilder : <<use>>

' Relazioni Regole
RegolaTinteggiatura ..> VoceTinteggiatura : <<create>>

' Utility Dependencies
CatalogoCicli ..> CicloInfo : gestisce >
CicloInfo --> CategoriaLavoro
CicloInfo --> SottoCategoriaLavoro
SalvataggioPreventivo ..> Preventivo : <<use>> (legge)
GestioneInputUI ..> GradoDifficolta : <<create>>

@enduml